<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neuro-Driver RC</title>

    <style>
        /* 1. 전체 페이지에서 터치 동작 제어 */
        body {
            background-color: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            
            /* 드래그, 텍스트 선택, 꾹 누르기 메뉴 완벽 차단 */
            -webkit-touch-callout: none; /* iOS 꾹 누를 때 돋보기/메뉴 금지 */
            -webkit-user-select: none;   /* 크롬/사파리 텍스트 선택 금지 */
            -khtml-user-select: none;
            -moz-user-select: none;      /* 파이어폭스 */
            -ms-user-select: none;       /* IE/엣지 */
            user-select: none;           /* 표준 */
            touch-action: none;          /* 확대/축소/스크롤 금지 (게임처럼) */
            
            /* 화면 꽉 차게 */
            height: 100vh;
            margin: 0;
            overflow: hidden; /* 스크롤바 숨김 */
        }

        h2 { margin-top: 20px; pointer-events: none; /* 제목 터치 무시 */ }
        #status { margin-bottom: 20px; font-weight: bold; color: #00ff00; }

        .control-grid {
            display: grid;
            grid-template-columns: 80px 80px 80px;
            grid-template-rows: 80px 80px;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            width: 80px;
            height: 80px;
            font-size: 30px;
            border-radius: 15px;
            border: 2px solid #555;
            background-color: #444;
            color: white;
            cursor: pointer;
            
            /* 버튼 내부에서도 선택 방지 이중 잠금 */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            
            /* 그림자 효과 */
            box-shadow: 0 6px #111;
            transition: all 0.1s;
        }

        /* 버튼 눌렀을 때 (PC/모바일 공통) */
        button:active {
            background-color: #ffcc00;
            color: black;
            box-shadow: 0 2px #000;
            transform: translateY(4px);
        }

        /* 빈 공간 */
        .empty { visibility: hidden; }
    </style>
</head>

<body>
    <h2>RC Controller</h2>
    <div id="status">Ready</div>

    <div class="control-grid">
        <div class="empty"></div>
        <button id="btn-fwd">▲</button>
        <div class="empty"></div>

        <button id="btn-left">◀</button>
        <button id="btn-back">▼</button>
        <button id="btn-right">▶</button>
    </div>

    <script>
        // 버튼 ID와 명령 매핑
        const buttons = {
            'btn-fwd': 'FORWARD',
            'btn-back': 'BACKWARD',
            'btn-left': 'LEFT',
            'btn-right': 'RIGHT'
        };

        const statusDiv = document.getElementById('status');

        // 서버 전송 함수
        function sendCommand(cmd) {
            statusDiv.innerText = "MOVE: " + cmd;
            fetch('/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'direction=' + cmd
            }).catch(err => console.log(err)); // 에러 무시 (빠른 반응 위해)
        }

        // 이벤트 리스너 등록 (HTML 태그보다 깔끔하고 강력함)
        for (const [id, cmd] of Object.entries(buttons)) {
            const btn = document.getElementById(id);

            // 1. 터치 시작 (누름)
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault(); // ★ 핵심: 브라우저가 "확대/메뉴" 하려는 걸 막음
                sendCommand(cmd);
                btn.style.backgroundColor = "#ffcc00"; // 즉각 반응용 색상 변경
                btn.style.color = "black";
                btn.style.transform = "translateY(4px)";
                btn.style.boxShadow = "0 2px #000";
            }, { passive: false });

            // 2. 터치 끝 (뗌)
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                sendCommand('STOP');
                btn.style.backgroundColor = "#444"; // 색상 복구
                btn.style.color = "white";
                btn.style.transform = "translateY(0)";
                btn.style.boxShadow = "0 6px #111";
            }, { passive: false });
        }

        // 화면 꾹 눌렀을 때 우클릭 메뉴 뜨는 것 방지 (화면 전체)
        document.addEventListener('contextmenu', event => event.preventDefault());
    </script>
</body>
</html>